from numpy import array


def case33_ac():
    """
    Power flow data for the AC part of the 33-bus hybrid test network.
    Test network data is adopted from Ahmed Haytham's PhD thesis titled
    "Optimal Planning and Operation of AC-DC Hybrid Distribution Systems".
    """
    # Initialize a dictionary to store the AC network data
    ppc = dict.fromkeys(['version', 'baseMVA', 'bus', 'gen', 'branch'])

    # Define the PYPOWER case format version
    ppc['version'] = '2'

    # Define the base MVA
    ppc['baseMVA'] = 10.0

    # Define the bus data
    # bus_i     type    Pd  Qd  Gs  Bs  area    Vm  Va  baseKV  zone    Vmax    Vmin
    ppc['bus'] = array([
        [1, 3, 0.00, 0.00, 0, 0, 1, 1.05, 0, 12.66, 1, 1.1, 0.9],
        [2, 1, 0.20, 0.12, 0, 0, 1, 1.00, 0, 12.66, 1, 1.1, 0.9],
        [3, 1, 0.18, 0.08, 0, 0, 1, 1.00, 0, 12.66, 1, 1.1, 0.9],
        [4, 1, 0.24, 0.16, 0, 0, 1, 1.00, 0, 12.66, 1, 1.1, 0.9],
        [5, 2, 0.125, 0.06, 0, 0, 1, 1.03, 0, 12.66, 1, 1.1, 0.9],
        [6, 1, 0.20, 0.10, 0, 0, 1, 1.00, 0, 12.66, 1, 1.1, 0.9],
        [7, 1, 0.20, 0.10, 0, 0, 1, 1.00, 0, 12.66, 1, 1.1, 0.9],
        [12, 1, 0.12, 0.07, 0, 0, 1, 1.00, 0, 12.66, 1, 1.1, 0.9],
        [13, 1, 0.06, 0.015, 0, 0, 1, 1.00, 0, 12.66, 1, 1.1, 0.9],
        [14, 1, 0.40, 0.20, 0, 0, 1, 1.00, 0, 12.66, 1, 1.1, 0.9],
        [15, 1, 0.26, 0.105, 0, 0, 1, 1.00, 0, 12.66, 1, 1.1, 0.9],
        [19, 1, 0.18, 0.08, 0, 0, 1, 1.00, 0, 12.66, 1, 1.1, 0.9],
        [20, 1, 0.18, 0.08, 0, 0, 1, 1.00, 0, 12.66, 1, 1.1, 0.9],
        [23, 1, 0.18, 0.10, 0, 0, 1, 1.00, 0, 12.66, 1, 1.1, 0.9],
        [24, 2, 0.115, 0.06, 0, 0, 1, 1.03, 0, 12.66, 1, 1.1, 0.9],
        [25, 1, 0.30, 0.10, 0, 0, 1, 1.00, 0, 12.66, 1, 1.1, 0.9],
        [29, 2, 0.085, 0.035, 0, 0, 1, 1.02, 0, 12.66, 1, 1.1, 0.9],
        [30, 1, 0.10, 0.06, 0, 0, 1, 1.00, 0, 12.66, 1, 1.1, 0.9],
        [31, 1, 0.17, 0.05, 0, 0, 1, 1.00, 0, 12.66, 1, 1.1, 0.9],
        [32, 1, 0.145, 0.07, 0, 0, 1, 1.00, 0, 12.66, 1, 1.1, 0.9],
        [33, 1, 0.24, 0.16, 0, 0, 1, 1.00, 0, 12.66, 1, 1.1, 0.9],
    ])

    # Define the generator data
    # bus   Pg  Qg  Qmax    Qmin    Vg  mBase   status  Pmax    Pmin
    ppc['gen'] = array([
        [1, 0.0, 0.0, 500, -500, 1.05, 100, 1, 999, 0],
        [5, 0.5, 0.0, 0.25, 0.05, 1.03, 100, 1, 999, 0],
        [24, 0.5, 0.0, 0.25, 0.05, 1.03, 100, 1, 999, 0],
        [29, 0.5, 0.0, 0.25, 0.05, 1.02, 100, 1, 999, 0],
    ])

    ## Define the branch data
    # from_bus  to_bus  r   x   b   rateA   rateB   rateC   ratio   angle   status
    ppc['branch'] = array([
        [1, 2, 0.0922, 0.0470, 0.00, 100, 100, 100, 0, 0, 1],
        [2, 3, 0.4930, 0.2511, 0.00, 100, 100, 100, 0, 0, 1],
        [2, 19, 0.1640, 0.1565, 0.00, 100, 100, 100, 0, 0, 1],
        [3, 4, 0.3660, 0.1864, 0.00, 100, 100, 100, 0, 0, 1],
        [3, 23, 0.4512, 0.3083, 0.00, 100, 100, 100, 0, 0, 1],
        [4, 5, 0.3811, 0.1941, 0.00, 100, 100, 100, 0, 0, 1],
        [5, 6, 0.8190, 0.7070, 0.00, 100, 100, 100, 0, 0, 1],
        [6, 7, 0.1872, 0.6188, 0.00, 100, 100, 100, 0, 0, 1],
        [12, 13, 1.4680, 1.1550, 0.00, 100, 100, 100, 0, 0, 1],
        [13, 14, 0.5416, 0.7129, 0.00, 100, 100, 100, 0, 0, 1],
        [14, 15, 0.5910, 0.5260, 0.00, 100, 100, 100, 0, 0, 1],
        [15, 31, 2.0000, 2.0000, 0.00, 100, 100, 100, 0, 0, 1],
        [19, 20, 1.5042, 1.3554, 0.00, 100, 100, 100, 0, 0, 1],
        [23, 24, 0.8980, 0.7091, 0.00, 100, 100, 100, 0, 0, 1],
        [24, 25, 0.8960, 0.7011, 0.00, 100, 100, 100, 0, 0, 1],
        [25, 29, 0.5000, 0.5000, 0.00, 100, 100, 100, 0, 0, 1],
        [29, 30, 0.5075, 0.2585, 0.00, 100, 100, 100, 0, 0, 1],
        [30, 31, 0.9744, 0.9630, 0.00, 100, 100, 100, 0, 0, 1],
        [31, 32, 0.3105, 0.3619, 0.00, 100, 100, 100, 0, 0, 1],
        [32, 33, 0.3410, 0.5302, 0.00, 100, 100, 100, 0, 0, 1]
    ])

    # Convert the branch resistance and reactance to per unit
    ppc['branch'][:, [2, 3]] = ppc['branch'][:, [2, 3]] / (12.66 ** 2 / ppc['baseMVA'])

    return ppc